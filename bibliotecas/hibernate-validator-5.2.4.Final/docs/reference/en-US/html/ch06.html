<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 6. Creating custom constraints</title><link rel="stylesheet" type="text/css" href="css/hibernate.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><link rel="home" href="index.html" title="Hibernate Validator 5.2.4.Final"/><link rel="up" href="index.html" title="Hibernate Validator 5.2.4.Final"/><link rel="prev" href="ch05.html" title="Chapter 5. Grouping constraints"/><link rel="next" href="ch07.html" title="Chapter 7. Configuring via XML"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="ch05.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch07.html"><strong>Next</strong></a></li></ul><div class="chapter" title="Chapter 6. Creating custom constraints"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints"/>Chapter 6. Creating custom constraints</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="ch06.html#validator-customconstraints-simple">6.1. Creating a simple constraint</a></span></dt><dd><dl><dt><span class="section"><a href="ch06.html#validator-customconstraints-constraintannotation">6.1.1. The constraint annotation</a></span></dt><dt><span class="section"><a href="ch06.html#section-constraint-validator">6.1.2. The constraint validator</a></span></dt><dt><span class="section"><a href="ch06.html#validator-customconstraints-errormessage">6.1.3. The error message</a></span></dt><dt><span class="section"><a href="ch06.html#validator-customconstraints-using">6.1.4. Using the constraint</a></span></dt></dl></dd><dt><span class="section"><a href="ch06.html#section-class-level-constraints">6.2. Class-level constraints</a></span></dt><dd><dl><dt><span class="section"><a href="ch06.html#section-custom-property-paths">6.2.1. Custom property paths</a></span></dt></dl></dd><dt><span class="section"><a href="ch06.html#section-cross-parameter-constraints">6.3. Cross-parameter constraints</a></span></dt><dt><span class="section"><a href="ch06.html#section-constraint-composition">6.4. Constraint composition</a></span></dt></dl></div><p>The Bean Validation API defines a whole set of standard constraint annotations such as <code class="literal">@NotNull</code>,
<code class="literal">@Size</code> etc. In cases where these buit-in constraints are not sufficient, you cean easily create
custom constraints tailored to your specific validation requirements.</p><div class="section" title="6.1. Creating a simple constraint"><div class="titlepage"><div><div><h2 class="title"><a id="validator-customconstraints-simple"/>6.1. Creating a simple constraint</h2></div></div></div><p>To create a custom constraint, the following three steps are required:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Create a constraint annotation</li><li class="listitem">Implement a validator</li><li class="listitem">Define a default error message</li></ul></div><div class="section" title="6.1.1. The constraint annotation"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-constraintannotation"/>6.1.1. The constraint annotation</h3></div></div></div><p>This section shows how to write a constraint annotation which can be used to ensure that a given
string is either completely upper case or lower case. Later on this constraint will be applied to
the <code class="literal">licensePlate</code> field of the <code class="literal">Car</code> class from <a class="xref" href="ch01.html" title="Chapter 1. Getting started">Chapter 1, <em>Getting started</em></a> to ensure, that
the field is always an upper-case string.</p><p>The first thing needed is a way to express the two case modes. While you could use <code class="literal">String</code> constants,
a better approach is using a Java 5 enum for that purpose:</p><div class="example"><a id="d0e3541"/><p class="title"><strong>Example 6.1. Enum <code class="literal">CaseMode</code> to express upper vs. lower case</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06;

public enum CaseMode {
	UPPER,
	LOWER;
}</code></pre></div></div><br class="example-break"/><p>The next step is to define the actual constraint annotation. If you’ve never designed an annotation
before, this may look a bit scary, but actually it’s not that hard:</p><div class="example"><a id="example-defining-custom-constraint"/><p class="title"><strong>Example 6.2. Defining the <code class="literal">@CheckCase</code> constraint annotation</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06;

@Target({ FIELD, METHOD, PARAMETER, ANNOTATION_TYPE })
@Retention(RUNTIME)
@Constraint(validatedBy = CheckCaseValidator.class)
@Documented
public @interface CheckCase {

	String message() default "{org.hibernate.validator.referenceguide.chapter06.CheckCase." +
			"message}";

	Class&lt;?&gt;[] groups() default { };

	Class&lt;? extends Payload&gt;[] payload() default { };

	CaseMode value();

	@Target({ FIELD, METHOD, PARAMETER, ANNOTATION_TYPE })
	@Retention(RUNTIME)
	@Documented
	@interface List {
		CheckCase[] value();
	}
}</code></pre></div></div><br class="example-break"/><p>An annotation type is defined using the <code class="literal">@interface</code> keyword. All attributes of an annotation type are
declared in a method-like manner. The specification of the Bean Validation API demands, that any
constraint annotation defines</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">an attribute <code class="literal">message</code> that returns the default key for creating error messages in case the
constraint is violated</li><li class="listitem">an attribute <code class="literal">groups</code> that allows the specification of validation groups, to which this constraint
belongs (see <a class="xref" href="ch05.html" title="Chapter 5. Grouping constraints">Chapter 5, <em>Grouping constraints</em></a>). This must default to an empty array of type Class&lt;?&gt;.</li><li class="listitem"><p class="simpara">an attribute <code class="literal">payload</code> that can be used by clients of the Bean Validation API to assign custom
payload objects to a constraint. This attribute is not used by the API itself. An example for a
custom payload could be the definition of a severity:</p><div class="informalexample"><pre><code class="language-java">public class Severity {
	public interface Info extends Payload {
	}

	public interface Error extends Payload {
	}
}

public class ContactDetails {
	@NotNull(message = "Name is mandatory", payload = Severity.Error.class)
	private String name;

	@NotNull(message = "Phone number not specified, but not mandatory",
			payload = Severity.Info.class)
	private String phoneNumber;

	// ...
}</code></pre></div><p class="simpara">Now a client can after the validation of a <code class="literal">ContactDetails</code> instance access the severity of a
constraint using <code class="literal">ConstraintViolation.getConstraintDescriptor().getPayload()</code> and adjust its behavior
depending on the severity.</p></li></ul></div><p>Besides these three mandatory attributes there is another one, <code class="literal">value</code>, allowing for the required case
mode to be specified. The name <code class="literal">value</code> is a special one, which can be omitted when using the
annotation, if it is the only attribute specified, as e.g. in <code class="literal">@CheckCase(CaseMode.UPPER)</code>.</p><p>In addition, the constraint annotation is decorated with a couple of meta annotations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p class="simpara"><code class="literal">@Target({ FIELD, METHOD, PARAMETER, ANNOTATION_TYPE})</code>: Defines the supported target element types
for the constraint. <code class="literal">@CheckCase</code> may be used on fields (element type <code class="literal">FIELD</code>), JavaBeans properties as
well as method return values (<code class="literal">METHOD</code>) and method/constructor parameters (<code class="literal">PARAMETER</code>). The element
type <code class="literal">ANNOTATION_TYPE</code> allows for the creation of composed constraints
(see <a class="xref" href="ch06.html#section-constraint-composition" title="6.4. Constraint composition">Section 6.4, “Constraint composition”</a>) based on <code class="literal">@CheckCase</code>.</p><p class="simpara">When creating a class-level constraint (see <a class="xref" href="ch02.html#validator-usingvalidator-classlevel" title="2.1.4. Class-level constraints">Section 2.1.4, “Class-level constraints”</a>), the element
type <code class="literal">TYPE</code> would have to be used. Constraints targeting the return value of a constructor need to
support the element type <code class="literal">CONSTRUCTOR</code>. Cross-parameter constraints (see
<a class="xref" href="ch06.html#section-cross-parameter-constraints" title="6.3. Cross-parameter constraints">Section 6.3, “Cross-parameter constraints”</a>) which are used to validate all the parameters of a method
or constructor together, must support <code class="literal">METHOD</code> or <code class="literal">CONSTRUCTOR</code>, respectively.</p></li><li class="listitem"><code class="literal">@Retention(RUNTIME)</code>: Specifies, that annotations of this type will be available at runtime by the
means of reflection</li><li class="listitem"><code class="literal">@Constraint(validatedBy = CheckCaseValidator.class)</code>: Marks the annotation type as constraint
annotation and specifies the validator to be used to validate elements annotated with <code class="literal">@CheckCase</code>.
If a constraint may be used on several data types, several validators may be specified, one for
each data type.</li><li class="listitem"><code class="literal">@Documented</code>: Says, that the use of <code class="literal">@CheckCase</code> will be contained in the JavaDoc of elements
annotated with it</li></ul></div><p>Finally, there is an inner annotation type named <code class="literal">List</code>. This annotation allows to specify several
<code class="literal">@CheckCase</code> annotations on the same element, e.g. with different validation groups and messages.
While also another name could be used, the Bean Validation specification recommends to use the name
<code class="literal">List</code> and make the annotation an inner annotation of the corresponding constraint type.</p></div><div class="section" title="6.1.2. The constraint validator"><div class="titlepage"><div><div><h3 class="title"><a id="section-constraint-validator"/>6.1.2. The constraint validator</h3></div></div></div><p>Having defined the annotation, you need to create a constraint validator, which is able to validate
elements with a <code class="literal">@CheckCase</code> annotation. To do so, implement the interface <code class="literal">ConstraintValidator</code> as
shown below:</p><div class="example"><a id="example-constraint-validator"/><p class="title"><strong>Example 6.3. Implementing a constraint validator for the constraint <code class="literal">@CheckCase</code></strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06;

public class CheckCaseValidator implements ConstraintValidator&lt;CheckCase, String&gt; {

	private CaseMode caseMode;

	@Override
	public void initialize(CheckCase constraintAnnotation) {
		this.caseMode = constraintAnnotation.value();
	}

	@Override
	public boolean isValid(String object, ConstraintValidatorContext constraintContext) {
		if ( object == null ) {
			return true;
		}

		if ( caseMode == CaseMode.UPPER ) {
			return object.equals( object.toUpperCase() );
		}
		else {
			return object.equals( object.toLowerCase() );
		}
	}
}</code></pre></div></div><br class="example-break"/><p>The <code class="literal">ConstraintValidator</code> interface defines two type parameters which are set in the implementation.
The first one specifies the annotation type to be validated (<code class="literal">CheckCase</code>), the second one the type of
elements, which the validator can handle (<code class="literal">String</code>). In case a constraint supports several data types,
a <code class="literal">ConstraintValidator</code> for each allowed type has to be implemented and registered at the constraint
annotation as shown above.</p><p>The implementation of the validator is straightforward. The <code class="literal">initialize()</code> method gives you access to
the attribute values of the validated constraint and allows you to store them in a field of the
validator as shown in the example.</p><p>The <code class="literal">isValid()</code> method contains the actual validation logic. For <code class="literal">@CheckCase</code> this is the check whether
a given string is either completely lower case or upper case, depending on the case mode retrieved
in <code class="literal">initialize()</code>. Note that the Bean Validation specification recommends to consider null values as
being valid. If <code class="literal">null</code> is not a valid value for an element, it should be annotated with <code class="literal">@NotNull</code>
explicitly.</p><div class="section" title="6.1.2.1. The ConstraintValidatorContext"><div class="titlepage"><div><div><h4 class="title"><a id="_the_literal_constraintvalidatorcontext_literal"/>6.1.2.1. The <code class="literal">ConstraintValidatorContext</code></h4></div></div></div><p><a class="xref" href="ch06.html#example-constraint-validator" title="Example 6.3. Implementing a constraint validator for the constraint @CheckCase">Example 6.3, “Implementing a constraint validator for the constraint <code class="literal">@CheckCase</code>”</a>
relies on the default error message generation by just returning <code class="literal">true</code> or <code class="literal">false</code> from the <code class="literal">isValid()</code>
method. Using the passed <code class="literal">ConstraintValidatorContext</code> object it is possible to either add additional
error messages or completely disable the default error message generation and solely define custom
error messages. The <code class="literal">ConstraintValidatorContext</code> API is modeled as fluent interface and is best
demonstrated with an example:</p><div class="example"><a id="example-constraint-validator-context"/><p class="title"><strong>Example 6.4. Using <code class="literal">ConstraintValidatorContext</code> to define custom error messages</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.constraintvalidatorcontext;

public class CheckCaseValidator implements ConstraintValidator&lt;CheckCase, String&gt; {

	private CaseMode caseMode;

	@Override
	public void initialize(CheckCase constraintAnnotation) {
		this.caseMode = constraintAnnotation.value();
	}

	@Override
	public boolean isValid(String object, ConstraintValidatorContext constraintContext) {
		if ( object == null ) {
			return true;
		}

		boolean isValid;
		if ( caseMode == CaseMode.UPPER ) {
			isValid = object.equals( object.toUpperCase() );
		}
		else {
			isValid = object.equals( object.toLowerCase() );
		}

		if ( !isValid ) {
			constraintContext.disableDefaultConstraintViolation();
			constraintContext.buildConstraintViolationWithTemplate(
					"{org.hibernate.validator.referenceguide.chapter03." +
					"constraintvalidatorcontext.CheckCase.message}"
			)
			.addConstraintViolation();
		}

		return isValid;
	}
}</code></pre></div></div><br class="example-break"/><p><a class="xref" href="ch06.html#example-constraint-validator-context" title="Example 6.4. Using ConstraintValidatorContext to define custom error messages">Example 6.4, “Using <code class="literal">ConstraintValidatorContext</code> to define custom error messages”</a>
shows how you can disable the default error message generation and add a custom error message using
a specified message template. In this example the use of the <code class="literal">ConstraintValidatorContext</code> results in
the same error message as the default error message generation.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p>It is important to add each configured constraint violation by calling <code class="literal">addConstraintViolation()</code>.
Only after that the new constraint violation will be created.</p></div><p>Refer to <a class="xref" href="ch06.html#section-custom-property-paths" title="6.2.1. Custom property paths">Section 6.2.1, “Custom property paths”</a> to learn how to use the <code class="literal">ConstraintValidatorContext</code> API to
control the property path of constraint violations for class-level constraints.</p></div></div><div class="section" title="6.1.3. The error message"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-errormessage"/>6.1.3. The error message</h3></div></div></div><p>The last missing building block is an error message which should be used in case a <code class="literal">@CheckCase</code>
constraint is violated. To define this, create a file <span class="emphasis"><em>ValidationMessages.properties</em></span> with the
following contents (see also <a class="xref" href="ch04.html#section-message-interpolation" title="4.1. Default message interpolation">Section 4.1, “Default message interpolation”</a>):</p><div class="example"><a id="d0e3802"/><p class="title"><strong>Example 6.5. Defining a custom error message for the <code class="literal">CheckCase</code> constraint</strong></p><div class="example-contents"><pre class="screen">org.hibernate.validator.referenceguide.chapter06.CheckCase.message=Case mode must be {value}.</pre></div></div><br class="example-break"/><p>If a validation error occurs, the validation runtime will use the default value, that you specified
for the message attribute of the <code class="literal">@CheckCase</code> annotation to look up the error message in this resource
bundle.</p></div><div class="section" title="6.1.4. Using the constraint"><div class="titlepage"><div><div><h3 class="title"><a id="validator-customconstraints-using"/>6.1.4. Using the constraint</h3></div></div></div><p>You can now use the constraint in the <code class="literal">Car</code> class from the <a class="xref" href="ch01.html" title="Chapter 1. Getting started">Chapter 1, <em>Getting started</em></a> chapter to
specify that the <code class="literal">licensePlate</code> field should only contain upper-case strings:</p><div class="example"><a id="example-car-with-checkcase"/><p class="title"><strong>Example 6.6. Applying the <code class="literal">@CheckCase</code> constraint</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06;

public class Car {

	@NotNull
	private String manufacturer;

	@NotNull
	@Size(min = 2, max = 14)
	@CheckCase(CaseMode.UPPER)
	private String licensePlate;

	@Min(2)
	private int seatCount;

	public Car ( String manufacturer, String licencePlate, int seatCount ) {
		this.manufacturer = manufacturer;
		this.licensePlate = licencePlate;
		this.seatCount = seatCount;
	}

	//getters and setters ...
}</code></pre></div></div><br class="example-break"/><p>Finally, <a class="xref" href="ch06.html#example-using-checkcase" title="Example 6.7. Validating objects with the @CheckCase constraint">Example 6.7, “Validating objects with the <code class="literal">@CheckCase</code> constraint”</a> demonstrates how validating a <code class="literal">Car</code> instance with an invalid
license plate causes the <code class="literal">@CheckCase</code> constraint to be violated.</p><div class="example"><a id="example-using-checkcase"/><p class="title"><strong>Example 6.7. Validating objects with the <code class="literal">@CheckCase</code> constraint</strong></p><div class="example-contents"><pre><code class="language-java">//invalid license plate
Car car = new Car( "Morris", "dd-ab-123", 4 );
Set&lt;ConstraintViolation&lt;Car&gt;&gt; constraintViolations =
		validator.validate( car );
assertEquals( 1, constraintViolations.size() );
assertEquals(
		"Case mode must be UPPER.",
		constraintViolations.iterator().next().getMessage()
);

//valid license plate
car = new Car( "Morris", "DD-AB-123", 4 );

constraintViolations = validator.validate( car );

assertEquals( 0, constraintViolations.size() );</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="6.2. Class-level constraints"><div class="titlepage"><div><div><h2 class="title"><a id="section-class-level-constraints"/>6.2. Class-level constraints</h2></div></div></div><p>As discussed earlier, constraints can also be applied on the class level to validate the state of an
entire object. Class-level constraints are defined in the same was as are property constraints.
<a class="xref" href="ch06.html#example-implementing-classlevel-constraint" title="Example 6.8. Implementing a class-level constraint">Example 6.8, “Implementing a class-level constraint”</a> shows constraint annotation and validator of the
<code class="literal">@ValidPassengerCount</code> constraint you already saw in use in <a class="xref" href="ch02.html#example-class-level" title="Example 2.7. Class-level constraint">Example 2.7, “Class-level constraint”</a>.</p><div class="example"><a id="example-implementing-classlevel-constraint"/><p class="title"><strong>Example 6.8. Implementing a class-level constraint</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.classlevel;

@Target({ TYPE, ANNOTATION_TYPE })
@Retention(RUNTIME)
@Constraint(validatedBy = { ValidPassengerCountValidator.class })
@Documented
public @interface ValidPassengerCount {

	String message() default "{org.hibernate.validator.referenceguide.chapter06.classlevel." +
			"ValidPassengerCount.message}";

	Class&lt;?&gt;[] groups() default { };

	Class&lt;? extends Payload&gt;[] payload() default { };
}</code></pre><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.classlevel;

public class ValidPassengerCountValidator
		implements ConstraintValidator&lt;ValidPassengerCount, Car&gt; {

	@Override
	public void initialize(ValidPassengerCount constraintAnnotation) {
	}

	@Override
	public boolean isValid(Car car, ConstraintValidatorContext context) {
		if ( car == null ) {
			return true;
		}

		return car.getPassengers().size() &lt;= car.getSeatCount();
	}
}</code></pre></div></div><br class="example-break"/><p>As the example demonstrates, you need to use the element type <code class="literal">TYPE</code> in the <code class="literal">@Target</code> annotation. This
allows the constraint to be put on type definitions. The validator of the constraint in the example
receives a <code class="literal">Car</code> in the <code class="literal">isValid()</code> method and can access the complete object state to decide whether
the given instance is valid or not.</p><div class="section" title="6.2.1. Custom property paths"><div class="titlepage"><div><div><h3 class="title"><a id="section-custom-property-paths"/>6.2.1. Custom property paths</h3></div></div></div><p>By default the constraint violation for a class-level constraint is reported on the level of the
annotated type, e.g. <code class="literal">Car</code>.</p><p>In some cases it is preferable though that the violation’s property path refers to one of the
involved properties. For instance you might want to report the <code class="literal">@ValidPassengerCount</code> constraint
against the passengers property instead of the <code class="literal">Car</code> bean.</p><p><a class="xref" href="ch06.html#example-custom-error" title="Example 6.9. Adding a new ConstraintViolation with custom property path">Example 6.9, “Adding a new <code class="literal">ConstraintViolation</code> with custom property path”</a>
shows how this can be done by using the constraint validator context passed to <code class="literal">isValid()</code> to build a
custom constraint violation with a property node for the property passengers. Note that you also
could add several property nodes, pointing to a sub-entity of the validated bean.</p><div class="example"><a id="example-custom-error"/><p class="title"><strong>Example 6.9. Adding a new <code class="literal">ConstraintViolation</code> with custom property path</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.custompath;

public class ValidPassengerCountValidator
		implements ConstraintValidator&lt;ValidPassengerCount, Car&gt; {

	@Override
	public void initialize(ValidPassengerCount constraintAnnotation) {
	}

	@Override
	public boolean isValid(Car car, ConstraintValidatorContext constraintValidatorContext) {
		if ( car == null ) {
			return true;
		}

		boolean isValid = car.getPassengers().size() &lt;= car.getSeatCount();

		if ( !isValid ) {
			constraintValidatorContext.disableDefaultConstraintViolation();
			constraintValidatorContext
					.buildConstraintViolationWithTemplate( "{my.custom.template}" )
					.addPropertyNode( "passengers" ).addConstraintViolation();
		}

		return isValid;
	}
}</code></pre></div></div><br class="example-break"/></div></div><div class="section" title="6.3. Cross-parameter constraints"><div class="titlepage"><div><div><h2 class="title"><a id="section-cross-parameter-constraints"/>6.3. Cross-parameter constraints</h2></div></div></div><p>Bean Validation distinguishes between two different kinds of constraints.</p><p>Generic constraints (which have been discussed so far) apply to the annotated element, e.g. a type,
field, method parameter or return value etc. Cross-parameter constraints, in contrast, apply to the
array of parameters of a method or constructor and can be used to express validation logic which
depends on several parameter values.</p><p>In order to define a cross-parameter constraint, its validator class must be annotated with
<code class="literal">@SupportedValidationTarget(ValidationTarget.PARAMETERS)</code>. The type parameter <code class="literal">T</code> from the
<code class="literal">ConstraintValidator</code> interface must resolve to either <code class="literal">Object</code> or <code class="literal">Object[]</code> in order to receive the
array of method/constructor arguments in the <code class="literal">isValid()</code> method.</p><p>The following example shows the definition of a cross-parameter constraint which can be used to
check that two <code class="literal">Date</code> parameters of a method are in the correct order:</p><div class="example"><a id="d0e3949"/><p class="title"><strong>Example 6.10. Cross-parameter constraint</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.crossparameter;

@Constraint(validatedBy = ConsistentDateParameterValidator.class)
@Target({ METHOD, CONSTRUCTOR, ANNOTATION_TYPE })
@Retention(RUNTIME)
@Documented
public @interface ConsistentDateParameters {

	String message() default "{org.hibernate.validator.referenceguide.chapter06." +
			"crossparameter.ConsistentDateParameters.message}";

	Class&lt;?&gt;[] groups() default { };

	Class&lt;? extends Payload&gt;[] payload() default { };
}</code></pre></div></div><br class="example-break"/><p>The definition of a cross-parameter constraint isn’t any different from defining a generic
constraint, i.e. it must specify the members <code class="literal">message()</code>, <code class="literal">groups()</code> and <code class="literal">payload()</code> and be annotated with
<code class="literal">@Constraint</code>. This meta annotation also specifies the corresponding validator, which is shown in
<a class="xref" href="ch06.html#example-cross-parameter-validator" title="Example 6.11. Generic and cross-parameter constraint">Example 6.11, “Generic and cross-parameter constraint”</a>. Note that besides the element types <code class="literal">METHOD</code> and <code class="literal">CONSTRUCTOR</code>
also <code class="literal">ANNOTATION_TYPE</code> is specified as target of the annotation, in order to enable the creation of
composed constraints based on <code class="literal">@ConsistentDateParameters</code> (see
<a class="xref" href="ch06.html#section-constraint-composition" title="6.4. Constraint composition">Section 6.4, “Constraint composition”</a>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Cross-parameter constraints are specified directly on the declaration of a method or constructor,
which is also the case for return value constraints. In order to improve code readability, it is
therefore recommended to chose constraint names - such as <code class="literal">@ConsistentDateParameters</code> - which make the
constraint target apparent.</p></div><div class="example"><a id="example-cross-parameter-validator"/><p class="title"><strong>Example 6.11. Generic and cross-parameter constraint</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.crossparameter;

@SupportedValidationTarget(ValidationTarget.PARAMETERS)
public class ConsistentDateParameterValidator implements
		ConstraintValidator&lt;ConsistentDateParameters, Object[]&gt; {

	@Override
	public void initialize(ConsistentDateParameters constraintAnnotation) {
	}

	@Override
	public boolean isValid(Object[] value, ConstraintValidatorContext context) {
		if ( value.length != 2 ) {
			throw new IllegalArgumentException( "Illegal method signature" );
		}

		//leave null-checking to @NotNull on individual parameters
		if ( value[0] == null || value[1] == null ) {
			return true;
		}

		if ( !( value[0] instanceof Date ) || !( value[1] instanceof Date ) ) {
			throw new IllegalArgumentException(
					"Illegal method signature, expected two " +
							"parameters of type Date."
			);
		}

		return ( (Date) value[0] ).before( (Date) value[1] );
	}
}</code></pre></div></div><br class="example-break"/><p>As discussed above, the validation target <code class="literal">PARAMETERS</code> must be configured for a cross-parameter
validator by using the <code class="literal">@SupportedValidationTarget</code> annotation. Since a cross-parameter constraint
could be applied to any method or constructor, it is considered a best practice to check for the
expected number and types of parameters in the validator implementation.</p><p>As with generic constraints, <code class="literal">null</code> parameters should be considered valid and <code class="literal">@NotNull</code> on the
individual parameters should be used to make sure that parameters are not <code class="literal">null</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2><p>Similar to class-level constraints, you can create custom constraint violations on single parameters
instead of all parameters when validating a cross-parameter constraint. Just obtain a node builder
from the <code class="literal">ConstraintValidatorContext</code> passed to <code class="literal">isValid()</code> and add a parameter node by calling
<code class="literal">addParameterNode()</code>. In the example you could use this to create a constraint violation on the end
date parameter of the validated method.</p></div><p>In rare situations a constraint is both, generic and cross-parameter. This is the case if a
constraint has a validator class which is annotated with
<code class="literal">@SupportedValidationTarget({ValidationTarget.PARAMETERS, ValidationTarget.ANNOTATED_ELEMENT})</code> or if
it has a generic and a cross-parameter validator class.</p><p>When declaring such a constraint on a method which has parameters and also a return value, the
intended constraint target can’t be determined. Constraints which are generic and cross-parameter at
the same time, must therefore define a member <code class="literal">validationAppliesTo()</code> which allows the constraint user
to specify the constraint’s target as shown in <a class="xref" href="ch06.html#example-dual-cross-parameter-constraint" title="Example 6.12. Generic and cross-parameter constraint">Example 6.12, “Generic and cross-parameter constraint”</a>.</p><div class="example"><a id="example-dual-cross-parameter-constraint"/><p class="title"><strong>Example 6.12. Generic and cross-parameter constraint</strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.crossparameter;

@Constraint(validatedBy = {
		ScriptAssertObjectValidator.class,
		ScriptAssertParametersValidator.class
})
@Target({ TYPE, FIELD, PARAMETER, METHOD, CONSTRUCTOR, ANNOTATION_TYPE })
@Retention(RUNTIME)
@Documented
public @interface ScriptAssert {

	String message() default "{org.hibernate.validator.referenceguide.chapter06." +
			"crossparameter.ScriptAssert.message}";

	Class&lt;?&gt;[] groups() default { };

	Class&lt;? extends Payload&gt;[] payload() default { };

	String script();

	ConstraintTarget validationAppliesTo() default ConstraintTarget.IMPLICIT;
}</code></pre></div></div><br class="example-break"/><p>The <code class="literal">@ScriptAssert</code> constraint has two validators (not shown), a generic and a cross-parameter one and
thus defines the member <code class="literal">validationAppliesTo()</code>. The default value <code class="literal">IMPLICIT</code> allows to derive the
target automatically in situations where this is possible (e.g. if the constraint is declared on a
field or on a method which has parameters but no return value).</p><p>If the target can not be determined implicitly, it must be set by the user to either <code class="literal">PARAMETERS</code> or
<code class="literal">RETURN_VALUE</code> as shown in <a class="xref" href="ch06.html#example-dual-cross-parameter-constraint-usage" title="Example 6.13. Specifying the target for a generic and cross-parameter constraint">Example 6.13, “Specifying the target for a generic and cross-parameter constraint”</a>.</p><div class="example"><a id="example-dual-cross-parameter-constraint-usage"/><p class="title"><strong>Example 6.13. Specifying the target for a generic and cross-parameter constraint</strong></p><div class="example-contents"><pre><code class="language-java">@ScriptAssert(script = "arg1.size() &lt;= arg0", validationAppliesTo = ConstraintTarget.PARAMETERS)
public Car buildCar(int seatCount, List&lt;Passenger&gt; passengers) {
	//...
}</code></pre></div></div><br class="example-break"/></div><div class="section" title="6.4. Constraint composition"><div class="titlepage"><div><div><h2 class="title"><a id="section-constraint-composition"/>6.4. Constraint composition</h2></div></div></div><p>Looking at the <code class="literal">licensePlate</code> field of the <code class="literal">Car</code> class in <a class="xref" href="ch06.html#example-car-with-checkcase" title="Example 6.6. Applying the @CheckCase constraint">Example 6.6, “Applying the <code class="literal">@CheckCase</code> constraint”</a>, you see three
constraint annotations already. In complexer scenarios, where even more constraints could be applied
to one element, this might become a bit confusing easily. Furthermore, if there was a <code class="literal">licensePlate</code>
field in another class, you would have to copy all constraint declarations to the other class as
well, violating the DRY principle.</p><p>You can address this kind of problem by creating higher level constraints, composed from several
basic constraints. <a class="xref" href="ch06.html#example-composed-constraint" title="Example 6.14. Creating a composing constraint @ValidLicensePlate">Example 6.14, “Creating a composing constraint <code class="literal">@ValidLicensePlate</code>”</a> shows a composed constraint annotation which
comprises the constraints <code class="literal">@NotNull</code>, <code class="literal">@Size</code> and <code class="literal">@CheckCase</code>:</p><div class="example"><a id="example-composed-constraint"/><p class="title"><strong>Example 6.14. Creating a composing constraint <code class="literal">@ValidLicensePlate</code></strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.constraintcomposition;

@NotNull
@Size(min = 2, max = 14)
@CheckCase(CaseMode.UPPER)
@Target({ METHOD, FIELD, ANNOTATION_TYPE })
@Retention(RUNTIME)
@Constraint(validatedBy = { })
@Documented
public @interface ValidLicensePlate {

	String message() default "{org.hibernate.validator.referenceguide.chapter06." +
			"constraintcomposition.ValidLicensePlate.message}";

	Class&lt;?&gt;[] groups() default { };

	Class&lt;? extends Payload&gt;[] payload() default { };
}</code></pre></div></div><br class="example-break"/><p>To create a composed constraint, simply annotate the constraint declaration with its comprising
constraints. If the composed constraint itself requires a validator, this validator is to be
specified within the <code class="literal">@Constraint</code> annotation. For composed constraints which don’t need an additional
validator such as <code class="literal">@ValidLicensePlate</code>, just set <code class="literal">validatedBy()</code> to an empty array.</p><p>Using the new composed constraint at the <code class="literal">licensePlate</code> field is fully equivalent to the previous
version, where the three constraints were declared directly at the field itself:</p><div class="example"><a id="d0e4121"/><p class="title"><strong>Example 6.15. Application of composing constraint <code class="literal">ValidLicensePlate</code></strong></p><div class="example-contents"><pre><code class="language-java">package org.hibernate.validator.referenceguide.chapter06.constraintcomposition;

public class Car {

	@ValidLicensePlate
	private String licensePlate;

	//...
}</code></pre></div></div><br class="example-break"/><p>The set of <code class="literal">ConstraintViolations</code> retrieved when validating a <code class="literal">Car</code> instance will contain an entry for
each violated composing constraint of the <code class="literal">@ValidLicensePlate</code> constraint. If you rather prefer a
single <code class="literal">ConstraintViolation</code> in case any of the composing constraints is violated, the
<code class="literal">@ReportAsSingleViolation</code> meta constraint can be used as follows:</p><div class="example"><a id="d0e4145"/><p class="title"><strong>Example 6.16. Using @ReportAsSingleViolation</strong></p><div class="example-contents"><pre><code class="language-java">//...
@ReportAsSingleViolation
public @interface ValidLicensePlate {

	String message() default "{org.hibernate.validator.referenceguide.chapter06." +
			"constraintcomposition.ValidLicensePlate.message}";

	Class&lt;?&gt;[] groups() default { };

	Class&lt;? extends Payload&gt;[] payload() default { };
}</code></pre></div></div><br class="example-break"/></div></div><script xmlns="" xmlns:d="http://docbook.org/ns/docbook" type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script xmlns="" xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">hljs.initHighlightingOnLoad();</script><script type="text/javascript">
dataLayer = [{'channel' : 'Hibernate', 'additional_tracking_code' : 'UA-45270411-3'}];
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJWS5L');</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NJWS5L" height="0" width="0" style="display:none;visibility:hidden"> </iframe></noscript><hr xmlns="" xmlns:d="http://docbook.org/ns/docbook"/><a xmlns="" xmlns:d="http://docbook.org/ns/docbook" href="legalnotice.html"/><ul class="docnav"><li class="previous"><a accesskey="p" href="ch05.html"><strong>Prev</strong>Chapter 5. Grouping constraints</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch07.html"><strong>Next</strong>Chapter 7. Configuring via XML</a></li></ul></body></html>